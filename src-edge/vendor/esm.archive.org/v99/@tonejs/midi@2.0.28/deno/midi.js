/* esm.sh - esbuild bundle(@tonejs/midi@2.0.28) deno production */
import * as __array_flatten$ from "/v99/array-flatten@3.0.0/deno/array-flatten.js";import __midi_file$ from "/v99/midi-file@1.2.4/deno/midi-file.js";var se=Object.create;var K=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var I=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var m=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var le=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ue(e))!he.call(r,i)&&i!==t&&K(r,i,{get:()=>e[i],enumerable:!(n=oe(e,i))||n.enumerable});return r};var fe=(r,e,t)=>(t=r!=null?se(ce(r)):{},le(e||!r||!r.__esModule?K(t,"default",{value:r,enumerable:!0}):t,r));var q=m(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.insert=v.search=void 0;function U(r,e,t){t===void 0&&(t="ticks");var n=0,i=r.length,a=i;if(i>0&&r[i-1][t]<=e)return i-1;for(;n<a;){var o=Math.floor(n+(a-n)/2),c=r[o],l=r[o+1];if(c[t]===e){for(var s=o;s<r.length;s++){var h=r[s];h[t]===e&&(o=s)}return o}else{if(c[t]<e&&l[t]>e)return o;c[t]>e?a=o:c[t]<e&&(n=o+1)}}return-1}v.search=U;function de(r,e,t){if(t===void 0&&(t="ticks"),r.length){var n=U(r,e[t],t);r.splice(n+1,0,e)}else r.push(e)}v.insert=de});var C=m(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.Header=g.keySignatureKeys=void 0;var j=q(),O=new WeakMap;g.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var me=function(){function r(e){var t=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",O.set(this,480),e){O.set(this,e.header.ticksPerBeat),e.tracks.forEach(function(i){i.forEach(function(a){a.meta&&(a.type==="timeSignature"?t.timeSignatures.push({ticks:a.absoluteTime,timeSignature:[a.numerator,a.denominator]}):a.type==="setTempo"?t.tempos.push({bpm:6e7/a.microsecondsPerBeat,ticks:a.absoluteTime}):a.type==="keySignature"&&t.keySignatures.push({key:g.keySignatureKeys[a.key+7],scale:a.scale===0?"major":"minor",ticks:a.absoluteTime}))})});var n=0;e.tracks[0].forEach(function(i){n+=i.deltaTime,i.meta&&(i.type==="trackName"?t.name=i.text:(i.type==="text"||i.type==="cuePoint"||i.type==="marker"||i.type==="lyrics")&&t.meta.push({text:i.text,ticks:n,type:i.type}))}),this.update()}}return r.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort(function(i,a){return i.ticks-a.ticks}),this.tempos.forEach(function(i,a){var o=a>0?e.tempos[a-1].bpm:e.tempos[0].bpm,c=i.ticks/e.ppq-n,l=60/o*c;i.time=l+t,t=i.time,n+=c}),this.timeSignatures.sort(function(i,a){return i.ticks-a.ticks}),this.timeSignatures.forEach(function(i,a){var o=a>0?e.timeSignatures[a-1]:e.timeSignatures[0],c=(i.ticks-o.ticks)/e.ppq,l=c/o.timeSignature[0]/(o.timeSignature[1]/4);o.measures=o.measures||0,i.measures=l+o.measures})},r.prototype.ticksToSeconds=function(e){var t=(0,j.search)(this.tempos,e);if(t!==-1){var n=this.tempos[t],i=n.time,a=(e-n.ticks)/this.ppq;return i+60/n.bpm*a}else{var o=e/this.ppq;return 60/120*o}},r.prototype.ticksToMeasures=function(e){var t=(0,j.search)(this.timeSignatures,e);if(t!==-1){var n=this.timeSignatures[t],i=(e-n.ticks)/this.ppq;return n.measures+i/(n.timeSignature[0]/n.timeSignature[1])/4}else return e/this.ppq/4},Object.defineProperty(r.prototype,"ppq",{get:function(){return O.get(this)},enumerable:!1,configurable:!0}),r.prototype.secondsToTicks=function(e){var t=(0,j.search)(this.tempos,e,"time");if(t!==-1){var n=this.tempos[t],i=n.time,a=e-i,o=a/(60/n.bpm);return Math.round(n.ticks+o*this.ppq)}else{var c=e/.5;return Math.round(c*this.ppq)}},r.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},r.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=e.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=e.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=e.meta.map(function(t){return Object.assign({},t)}),O.set(this,e.ppq),this.update()},r.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},r}();g.Header=me});var E=m(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.ControlChange=f.controlChangeIds=f.controlChangeNames=void 0;f.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"};f.controlChangeIds=Object.keys(f.controlChangeNames).reduce(function(r,e){return r[f.controlChangeNames[e]]=e,r},{});var J=new WeakMap,V=new WeakMap,pe=function(){function r(e,t){J.set(this,t),V.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(r.prototype,"number",{get:function(){return V.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return f.controlChangeNames[this.number]?f.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){var e=J.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var t=J.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},r}();f.ControlChange=pe});var L=m(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.createControlChanges=void 0;var S=E();function be(){return new Proxy({},{get:function(r,e){if(r[e])return r[e];if(S.controlChangeIds.hasOwnProperty(e))return r[S.controlChangeIds[e]]},set:function(r,e,t){return S.controlChangeIds.hasOwnProperty(e)?r[S.controlChangeIds[e]]=t:r[e]=t,!0}})}w.createControlChanges=be});var Q=m(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.PitchBend=void 0;var H=new WeakMap,ye=function(){function r(e,t){H.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(r.prototype,"time",{get:function(){var e=H.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var t=H.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},r}();N.PitchBend=ye});var R=m(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.DrumKitByPatchID=b.InstrumentFamilyByID=b.instrumentByPatchID=void 0;b.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];b.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];b.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}});var Y=m(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.Instrument=void 0;var _=R(),X=new WeakMap,ge=function(){function r(e,t){if(this.number=0,X.set(this,t),this.number=0,e){var n=e.find(function(i){return i.type==="programChange"});n&&(this.number=n.programNumber)}}return Object.defineProperty(r.prototype,"name",{get:function(){return this.percussion?_.DrumKitByPatchID[this.number]:_.instrumentByPatchID[this.number]},set:function(e){var t=_.instrumentByPatchID.indexOf(e);t!==-1&&(this.number=t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"family",{get:function(){return this.percussion?"drums":_.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"percussion",{get:function(){var e=X.get(this);return e.channel===9},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},r.prototype.fromJSON=function(e){this.number=e.number},r}();P.Instrument=ge});var $=m(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.Note=void 0;function ve(r){var e=Math.floor(r/12)-1;return Z(r)+e.toString()}function Z(r){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=r%12;return e[t]}function ke(r){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(r)}var Te=function(){var r=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(t){var n=r.exec(t),i=n[1],a=n[2],o=e[i.toLowerCase()];return o+(parseInt(a,10)+1)*12}}(),k=new WeakMap,Oe=function(){function r(e,t,n){k.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(r.prototype,"name",{get:function(){return ve(this.midi)},set:function(e){this.midi=Te(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=t*12},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pitch",{get:function(){return Z(this.midi)},set:function(e){this.midi=12*(this.octave+1)+ke(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){var e=k.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=k.get(this),n=t.secondsToTicks(this.time+e);this.durationTicks=n-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"time",{get:function(){var e=k.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var t=k.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bars",{get:function(){var e=k.get(this);return e.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},r}();M.Note=Oe});var D=m(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.Track=void 0;var A=q(),Ce=E(),Se=L(),we=Q(),ee=Y(),Ne=$(),x=new WeakMap,_e=function(){function r(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,Se.createControlChanges)(),this.pitchBends=[],x.set(this,t),e){var i=e.find(function(u){return u.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new ee.Instrument(e,this),this.channel=0,e){for(var a=e.filter(function(u){return u.type==="noteOn"}),o=e.filter(function(u){return u.type==="noteOff"}),c=function(){var u=a.shift();l.channel=u.channel;var W=o.findIndex(function(G){return G.noteNumber===u.noteNumber&&G.absoluteTime>=u.absoluteTime});if(W!==-1){var z=o.splice(W,1)[0];l.addNote({durationTicks:z.absoluteTime-u.absoluteTime,midi:u.noteNumber,noteOffVelocity:z.velocity/127,ticks:u.absoluteTime,velocity:u.velocity/127})}},l=this;a.length;)c();var s=e.filter(function(u){return u.type==="controller"});s.forEach(function(u){n.addCC({number:u.controllerType,ticks:u.absoluteTime,value:u.value/127})});var h=e.filter(function(u){return u.type==="pitchBend"});h.forEach(function(u){n.addPitchBend({ticks:u.absoluteTime,value:u.value/Math.pow(2,13)})});var p=e.find(function(u){return u.type==="endOfTrack"});this.endOfTrackTicks=p!==void 0?p.absoluteTime:void 0}}return r.prototype.addNote=function(e){var t=x.get(this),n=new Ne.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),(0,A.insert)(this.notes,n,"ticks"),this},r.prototype.addCC=function(e){var t=x.get(this),n=new Ce.ControlChange({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),(0,A.insert)(this.controlChanges[n.number],n,"ticks"),this},r.prototype.addPitchBend=function(e){var t=x.get(this),n=new we.PitchBend({},t);return Object.assign(n,e),(0,A.insert)(this.pitchBends,n,"ticks"),this},Object.defineProperty(r.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),r.prototype.fromJSON=function(e){var t=this;this.name=e.name,this.channel=e.channel,this.instrument=new ee.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=e.endOfTrackTicks);for(var n in e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(i){t.addCC({number:i.number,ticks:i.ticks,value:i.value})});e.notes.forEach(function(i){t.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},r.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(i){return i.toJSON()}));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(n.endOfTrackTicks=this.endOfTrackTicks),n},r}();B.Track=_e});var te=m(T=>{"use strict";var y=T&&T.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,a;n<i;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return r.concat(a||Array.prototype.slice.call(e))};Object.defineProperty(T,"__esModule",{value:!0});T.encode=void 0;var Pe=__midi_file$,Me=C(),xe=__array_flatten$;function Be(r,e){return[{absoluteTime:r.ticks,channel:e,deltaTime:0,noteNumber:r.midi,type:"noteOn",velocity:Math.floor(r.velocity*127)},{absoluteTime:r.ticks+r.durationTicks,channel:e,deltaTime:0,noteNumber:r.midi,type:"noteOff",velocity:Math.floor(r.noteOffVelocity*127)}]}function Ie(r){return(0,xe.flatten)(r.notes.map(function(e){return Be(e,r.channel)}))}function qe(r,e){return{absoluteTime:r.ticks,channel:e,controllerType:r.number,deltaTime:0,type:"controller",value:Math.floor(r.value*127)}}function je(r){for(var e=[],t=0;t<127;t++)r.controlChanges.hasOwnProperty(t)&&r.controlChanges[t].forEach(function(n){e.push(qe(n,r.channel))});return e}function Je(r,e){return{absoluteTime:r.ticks,channel:e,deltaTime:0,type:"pitchBend",value:r.value}}function Ee(r){var e=[];return r.pitchBends.forEach(function(t){e.push(Je(t,r.channel))}),e}function He(r){return{absoluteTime:0,channel:r.channel,deltaTime:0,programNumber:r.instrument.number,type:"programChange"}}function Ae(r){return{absoluteTime:0,deltaTime:0,meta:!0,text:r,type:"trackName"}}function De(r){return{absoluteTime:r.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/r.bpm),type:"setTempo"}}function Fe(r){return{absoluteTime:r.ticks,deltaTime:0,denominator:r.timeSignature[1],meta:!0,metronome:24,numerator:r.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function We(r){var e=Me.keySignatureKeys.indexOf(r.key);return{absoluteTime:r.ticks,deltaTime:0,key:e+7,meta:!0,scale:r.scale==="major"?0:1,type:"keySignature"}}function ze(r){return{absoluteTime:r.ticks,deltaTime:0,meta:!0,text:r.text,type:r.type}}function Ge(r){var e={header:{format:1,numTracks:r.tracks.length+1,ticksPerBeat:r.header.ppq},tracks:y([y(y(y(y([{absoluteTime:0,deltaTime:0,meta:!0,text:r.header.name,type:"trackName"}],r.header.keySignatures.map(function(t){return We(t)}),!0),r.header.meta.map(function(t){return ze(t)}),!0),r.header.tempos.map(function(t){return De(t)}),!0),r.header.timeSignatures.map(function(t){return Fe(t)}),!0)],r.tracks.map(function(t){return y(y(y([Ae(t.name),He(t)],Ie(t),!0),je(t),!0),Ee(t),!0)}),!0)};return e.tracks=e.tracks.map(function(t){t=t.sort(function(i,a){return i.absoluteTime-a.absoluteTime});var n=0;return t.forEach(function(i){i.deltaTime=i.absoluteTime-n,n=i.absoluteTime,delete i.absoluteTime}),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t}),new Uint8Array((0,Pe.writeMidi)(e))}T.encode=Ge});var ne=m(d=>{"use strict";var Ke=d&&d.__awaiter||function(r,e,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function c(h){try{s(n.next(h))}catch(p){o(p)}}function l(h){try{s(n.throw(h))}catch(p){o(p)}}function s(h){h.done?a(h.value):i(h.value).then(c,l)}s((n=n.apply(r,e||[])).next())})},Ue=d&&d.__generator||function(r,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(s){return function(h){return l([s,h])}}function l(s){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=s[0]&2?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return t.label++,{value:s[1],done:!1};case 5:t.label++,i=s[1],s=[0];continue;case 7:s=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){t=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){t.label=s[1];break}if(s[0]===6&&t.label<a[1]){t.label=a[1],a=s;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(s);break}a[2]&&t.ops.pop(),t.trys.pop();continue}s=e.call(r,t)}catch(h){s=[6,h],i=0}finally{n=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(d,"__esModule",{value:!0});d.Header=d.Track=d.Midi=void 0;var Ve=__midi_file$,re=C(),F=D(),Le=te(),Qe=function(){function r(e){var t=this,n=null;if(e){var i=e instanceof ArrayBuffer?new Uint8Array(e):e;n=(0,Ve.parseMidi)(i),n.tracks.forEach(function(a){var o=0;a.forEach(function(c){o+=c.deltaTime,c.absoluteTime=o})}),n.tracks=Ye(n.tracks)}this.header=new re.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map(function(a){return new F.Track(a,t.header)}),n.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return r.fromUrl=function(e){return Ke(this,void 0,void 0,function(){var t,n;return Ue(this,function(i){switch(i.label){case 0:return[4,fetch(e)];case 1:return t=i.sent(),t.ok?[4,t.arrayBuffer()]:[3,3];case 2:return n=i.sent(),[2,new r(n)];case 3:throw new Error("Could not load '".concat(e,"'"))}})})},Object.defineProperty(r.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){var e=this.tracks.map(function(t){return t.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(t){return t.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),r.prototype.addTrack=function(){var e=new F.Track(void 0,this.header);return this.tracks.push(e),e},r.prototype.toArray=function(){return(0,Le.encode)(this)},r.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},r.prototype.fromJSON=function(e){var t=this;this.header=new re.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(n){var i=new F.Track(void 0,t.header);return i.fromJSON(n),i})},r.prototype.clone=function(){var e=new r;return e.fromJSON(this.toJSON()),e},r}();d.Midi=Qe;var Re=D();Object.defineProperty(d,"Track",{enumerable:!0,get:function(){return Re.Track}});var Xe=C();Object.defineProperty(d,"Header",{enumerable:!0,get:function(){return Xe.Header}});function Ye(r){for(var e=[],t=0;t<r.length;t++)for(var n=e.length,i=new Map,a=Array(16).fill(0),o=0,c=r[t];o<c.length;o++){var l=c[o],s=n,h=l.channel;if(h!==void 0){l.type==="programChange"&&(a[h]=l.programNumber);var p=a[h],u="".concat(p," ").concat(h);i.has(u)?s=i.get(u):(s=n+i.size,i.set(u,s))}e[s]||e.push([]),e[s].push(l)}return e}});var ae=fe(ne()),lt=!0,{Header:ft,Track:dt,Midi:mt}=ae,{default:ie,...Ze}=ae,pt=ie!==void 0?ie:Ze;export{ft as Header,mt as Midi,dt as Track,lt as __esModule,pt as default};
