/* esm.sh - esbuild bundle(midi-file@1.2.4) deno production */
var B=Object.create;var F=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var E=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of P(e))!T.call(t,i)&&i!==n&&F(t,i,{get:()=>e[i],enumerable:!(o=M(e,i))||o.enumerable});return t};var C=(t,e,n)=>(n=t!=null?B(N(t)):{},E(e||!t||!t.__esModule?F(n,"default",{value:t,enumerable:!0}):n,t));var m=y((z,b)=>{function O(t){var e=new f(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var o=D(n.data),i=[],c=0;!e.eof()&&c<o.numTracks;c++){var r=e.readChunk();if(r.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+r.id+"'";var u=q(r.data);i.push(u)}return{header:o,tracks:i}}function D(t){var e=new f(t),n=e.readUInt16(),o=e.readUInt16(),i={format:n,numTracks:o},c=e.readUInt16();return c&32768?(i.framesPerSecond=256-(c>>8),i.ticksPerFrame=c&255):i.ticksPerBeat=c,i}function q(t){for(var e=new f(t),n=[];!e.eof();){var o=c();n.push(o)}return n;var i;function c(){var r={};r.deltaTime=e.readVarInt();var u=e.readUInt8();if((u&240)===240)if(u===255){r.meta=!0;var s=e.readUInt8(),a=e.readVarInt();switch(s){case 0:if(r.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return r.number=e.readUInt16(),r;case 1:return r.type="text",r.text=e.readString(a),r;case 2:return r.type="copyrightNotice",r.text=e.readString(a),r;case 3:return r.type="trackName",r.text=e.readString(a),r;case 4:return r.type="instrumentName",r.text=e.readString(a),r;case 5:return r.type="lyrics",r.text=e.readString(a),r;case 6:return r.type="marker",r.text=e.readString(a),r;case 7:return r.type="cuePoint",r.text=e.readString(a),r;case 32:if(r.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return r.channel=e.readUInt8(),r;case 33:if(r.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return r.port=e.readUInt8(),r;case 47:if(r.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return r;case 81:if(r.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return r.microsecondsPerBeat=e.readUInt24(),r;case 84:if(r.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var U=e.readUInt8(),h={0:24,32:25,64:29,96:30};return r.frameRate=h[U&96],r.hour=U&31,r.min=e.readUInt8(),r.sec=e.readUInt8(),r.frame=e.readUInt8(),r.subFrame=e.readUInt8(),r;case 88:if(r.type="timeSignature",a!=2&&a!=4)throw"Expected length for timeSignature event is 4 or 2, got "+a;return r.numerator=e.readUInt8(),r.denominator=1<<e.readUInt8(),a===4?(r.metronome=e.readUInt8(),r.thirtyseconds=e.readUInt8()):(r.metronome=36,r.thirtyseconds=8),r;case 89:if(r.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return r.key=e.readInt8(),r.scale=e.readUInt8(),r;case 127:return r.type="sequencerSpecific",r.data=e.readBytes(a),r;default:return r.type="unknownMeta",r.data=e.readBytes(a),r.metatypeByte=s,r}}else if(u==240){r.type="sysEx";var a=e.readVarInt();return r.data=e.readBytes(a),r}else if(u==247){r.type="endSysEx";var a=e.readVarInt();return r.data=e.readBytes(a),r}else throw"Unrecognised MIDI event type byte: "+u;else{var x;if(u&128)x=e.readUInt8(),i=u;else{if(i===null)throw"Running status byte encountered before status byte";x=u,u=i,r.running=!0}var d=u>>4;switch(r.channel=u&15,d){case 8:return r.type="noteOff",r.noteNumber=x,r.velocity=e.readUInt8(),r;case 9:var p=e.readUInt8();return r.type=p===0?"noteOff":"noteOn",r.noteNumber=x,r.velocity=p,p===0&&(r.byte9=!0),r;case 10:return r.type="noteAftertouch",r.noteNumber=x,r.amount=e.readUInt8(),r;case 11:return r.type="controller",r.controllerType=x,r.value=e.readUInt8(),r;case 12:return r.type="programChange",r.programNumber=x,r;case 13:return r.type="channelAftertouch",r.amount=x,r;case 14:return r.type="pitchBend",r.value=x+(e.readUInt8()<<7)-8192,r;default:throw"Unrecognised MIDI event type: "+d}}}}function f(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}f.prototype.eof=function(){return this.pos>=this.bufferLen};f.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t};f.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t};f.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e};f.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t};f.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n};f.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t};f.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),o=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+o};f.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e};f.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)};f.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t};f.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}};b.exports=O});var k=y((W,w)=>{function A(t,e){if(typeof t!="object")throw"Invalid MIDI data";e=e||{};var n=t.header||{},o=t.tracks||[],i,c=o.length,r=new I;for(_(r,n,c),i=0;i<c;i++)H(r,o[i],e);return r.buffer}function _(t,e,n){var o=e.format==null?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(e.framesPerSecond&255)<<8|e.ticksPerFrame&255:e.ticksPerBeat&&(i=e.ticksPerBeat&32767);var c=new I;c.writeUInt16(o),c.writeUInt16(n),c.writeUInt16(i),t.writeChunk("MThd",c.buffer)}function H(t,e,n){var o=new I,i,c=e.length,r=null;for(i=0;i<c;i++)(n.running===!1||!n.running&&!e[i].running)&&(r=null),r=L(o,e[i],r,n.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function L(t,e,n,o){var i=e.type,c=e.deltaTime,r=e.text||"",u=e.data||[],s=null;switch(t.writeVarInt(c),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(r.length),t.writeString(r);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(r.length),t.writeString(r);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(r.length),t.writeString(r);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(r.length),t.writeString(r);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(r.length),t.writeString(r);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(r.length),t.writeString(r);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(r.length),t.writeString(r);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var a={24:0,25:32,29:64,30:96},U=e.hour&31|a[e.frameRate];t.writeUInt8(U),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=Math.floor(Math.log(e.denominator)/Math.LN2)&255;t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(u.length),t.writeBytes(u);break;case"unknownMeta":e.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(u.length),t.writeBytes(u));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(u.length),t.writeBytes(u);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(u.length),t.writeBytes(u);break;case"noteOff":var x=o!==!1&&e.byte9||o&&e.velocity==0?144:128;s=x|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":s=144|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":s=160|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":s=176|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":s=192|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.programNumber);break;case"channelAftertouch":s=208|e.channel,s!==n&&t.writeUInt8(s),t.writeUInt8(e.amount);break;case"pitchBend":s=224|e.channel,s!==n&&t.writeUInt8(s);var d=8192+e.value,p=d&127,V=d>>7&127;t.writeUInt8(p),t.writeUInt8(V);break;default:throw"Unrecognized event type: "+i}return s}function I(){this.buffer=[]}I.prototype.writeUInt8=function(t){this.buffer.push(t&255)};I.prototype.writeInt8=I.prototype.writeUInt8;I.prototype.writeUInt16=function(t){var e=t>>8&255,n=t&255;this.writeUInt8(e),this.writeUInt8(n)};I.prototype.writeInt16=I.prototype.writeUInt16;I.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,o=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(o)};I.prototype.writeInt24=I.prototype.writeUInt24;I.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,o=t>>8&255,i=t&255;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(o),this.writeUInt8(i)};I.prototype.writeInt32=I.prototype.writeUInt32;I.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))};I.prototype.writeString=function(t){var e,n=t.length,o=[];for(e=0;e<n;e++)o.push(t.codePointAt(e));this.writeBytes(o)};I.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(e&127),e>>=7;e;){var o=e&127|128;n.push(o),e>>=7}this.writeBytes(n.reverse())}};I.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)};w.exports=A});var g=y(l=>{l.parseMidi=m();l.writeMidi=k()});var S=C(g()),{parseMidi:J,writeMidi:K}=S,{default:v,...R}=S,Q=v!==void 0?v:R;export{Q as default,J as parseMidi,K as writeMidi};
