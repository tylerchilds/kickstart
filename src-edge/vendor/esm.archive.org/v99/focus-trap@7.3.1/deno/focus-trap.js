/* esm.sh - esbuild bundle(focus-trap@7.3.1) deno production */
import{tabbable as Q,focusable as U,isTabbable as k,isFocusable as x}from"/v99/tabbable@6.1.1/deno/tabbable.js";function G(u,t){var o=Object.keys(u);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(u);t&&(n=n.filter(function(d){return Object.getOwnPropertyDescriptor(u,d).enumerable})),o.push.apply(o,n)}return o}function S(u){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?G(Object(o),!0).forEach(function(n){W(u,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(o)):G(Object(o)).forEach(function(n){Object.defineProperty(u,n,Object.getOwnPropertyDescriptor(o,n))})}return u}function W(u,t,o){return t=Z(t),t in u?Object.defineProperty(u,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):u[t]=o,u}function X(u,t){if(typeof u!="object"||u===null)return u;var o=u[Symbol.toPrimitive];if(o!==void 0){var n=o.call(u,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(u)}function Z(u){var t=X(u,"string");return typeof t=="symbol"?t:String(t)}var q={activateTrap:function(t,o){if(t.length>0){var n=t[t.length-1];n!==o&&n.pause()}var d=t.indexOf(o);d===-1||t.splice(d,1),t.push(o)},deactivateTrap:function(t,o){var n=t.indexOf(o);n!==-1&&t.splice(n,1),t.length>0&&t[t.length-1].unpause()}},$=function(t){return t.tagName&&t.tagName.toLowerCase()==="input"&&typeof t.select=="function"},_=function(t){return t.key==="Escape"||t.key==="Esc"||t.keyCode===27},E=function(t){return t.key==="Tab"||t.keyCode===9},ee=function(t){return E(t)&&!t.shiftKey},te=function(t){return E(t)&&t.shiftKey},H=function(t){return setTimeout(t,0)},Y=function(t,o){var n=-1;return t.every(function(d,c){return o(d)?(n=c,!1):!0}),n},N=function(t){for(var o=arguments.length,n=new Array(o>1?o-1:0),d=1;d<o;d++)n[d-1]=arguments[d];return typeof t=="function"?t.apply(void 0,n):t},O=function(t){return t.target.shadowRoot&&typeof t.composedPath=="function"?t.composedPath()[0]:t.target},ae=[],ne=function(t,o){var n=o?.document||document,d=o?.trapStack||ae,c=S({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:ee,isKeyBackward:te},o),r={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},p,g=function(e,a,i){return e&&e[a]!==void 0?e[a]:c[i||a]},y=function(e){return r.containerGroups.findIndex(function(a){var i=a.container,s=a.tabbableNodes;return i.contains(e)||s.find(function(f){return f===e})})},m=function(e){var a=c[e];if(typeof a=="function"){for(var i=arguments.length,s=new Array(i>1?i-1:0),f=1;f<i;f++)s[f-1]=arguments[f];a=a.apply(void 0,s)}if(a===!0&&(a=void 0),!a){if(a===void 0||a===!1)return a;throw new Error("`".concat(e,"` was specified but was not a node, or did not return a node"))}var b=a;if(typeof a=="string"&&(b=n.querySelector(a),!b))throw new Error("`".concat(e,"` as selector refers to no known node"));return b},D=function(){var e=m("initialFocus");if(e===!1)return!1;if(e===void 0)if(y(n.activeElement)>=0)e=n.activeElement;else{var a=r.tabbableGroups[0],i=a&&a.firstTabbableNode;e=i||m("fallbackFocus")}if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},F=function(){if(r.containerGroups=r.containers.map(function(e){var a=Q(e,c.tabbableOptions),i=U(e,c.tabbableOptions);return{container:e,tabbableNodes:a,focusableNodes:i,firstTabbableNode:a.length>0?a[0]:null,lastTabbableNode:a.length>0?a[a.length-1]:null,nextTabbableNode:function(f){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=i.findIndex(function(h){return h===f});if(!(v<0))return b?i.slice(v+1).find(function(h){return k(h,c.tabbableOptions)}):i.slice(0,v).reverse().find(function(h){return k(h,c.tabbableOptions)})}}}),r.tabbableGroups=r.containerGroups.filter(function(e){return e.tabbableNodes.length>0}),r.tabbableGroups.length<=0&&!m("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},w=function l(e){if(e!==!1&&e!==n.activeElement){if(!e||!e.focus){l(D());return}e.focus({preventScroll:!!c.preventScroll}),r.mostRecentlyFocusedNode=e,$(e)&&e.select()}},A=function(e){var a=m("setReturnFocus",e);return a||(a===!1?!1:e)},P=function(e){var a=O(e);if(!(y(a)>=0)){if(N(c.clickOutsideDeactivates,e)){p.deactivate({returnFocus:c.returnFocusOnDeactivate});return}N(c.allowOutsideClick,e)||e.preventDefault()}},L=function(e){var a=O(e),i=y(a)>=0;i||a instanceof Document?i&&(r.mostRecentlyFocusedNode=a):(e.stopImmediatePropagation(),w(r.mostRecentlyFocusedNode||D()))},V=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=O(e);F();var s=null;if(r.tabbableGroups.length>0){var f=y(i),b=f>=0?r.containerGroups[f]:void 0;if(f<0)a?s=r.tabbableGroups[r.tabbableGroups.length-1].lastTabbableNode:s=r.tabbableGroups[0].firstTabbableNode;else if(a){var v=Y(r.tabbableGroups,function(C){var K=C.firstTabbableNode;return i===K});if(v<0&&(b.container===i||x(i,c.tabbableOptions)&&!k(i,c.tabbableOptions)&&!b.nextTabbableNode(i,!1))&&(v=f),v>=0){var h=v===0?r.tabbableGroups.length-1:v-1,z=r.tabbableGroups[h];s=z.lastTabbableNode}else E(e)||(s=b.nextTabbableNode(i,!1))}else{var T=Y(r.tabbableGroups,function(C){var K=C.lastTabbableNode;return i===K});if(T<0&&(b.container===i||x(i,c.tabbableOptions)&&!k(i,c.tabbableOptions)&&!b.nextTabbableNode(i))&&(T=f),T>=0){var J=T===r.tabbableGroups.length-1?0:T+1,M=r.tabbableGroups[J];s=M.firstTabbableNode}else E(e)||(s=b.nextTabbableNode(i))}}else s=m("fallbackFocus");s&&(E(e)&&e.preventDefault(),w(s))},R=function(e){if(_(e)&&N(c.escapeDeactivates,e)!==!1){e.preventDefault(),p.deactivate();return}(c.isKeyForward(e)||c.isKeyBackward(e))&&V(e,c.isKeyBackward(e))},B=function(e){var a=O(e);y(a)>=0||N(c.clickOutsideDeactivates,e)||N(c.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},I=function(){if(r.active)return q.activateTrap(d,p),r.delayInitialFocusTimer=c.delayInitialFocus?H(function(){w(D())}):w(D()),n.addEventListener("focusin",L,!0),n.addEventListener("mousedown",P,{capture:!0,passive:!1}),n.addEventListener("touchstart",P,{capture:!0,passive:!1}),n.addEventListener("click",B,{capture:!0,passive:!1}),n.addEventListener("keydown",R,{capture:!0,passive:!1}),p},j=function(){if(r.active)return n.removeEventListener("focusin",L,!0),n.removeEventListener("mousedown",P,!0),n.removeEventListener("touchstart",P,!0),n.removeEventListener("click",B,!0),n.removeEventListener("keydown",R,!0),p};return p={get active(){return r.active},get paused(){return r.paused},activate:function(e){if(r.active)return this;var a=g(e,"onActivate"),i=g(e,"onPostActivate"),s=g(e,"checkCanFocusTrap");s||F(),r.active=!0,r.paused=!1,r.nodeFocusedBeforeActivation=n.activeElement,a&&a();var f=function(){s&&F(),I(),i&&i()};return s?(s(r.containers.concat()).then(f,f),this):(f(),this)},deactivate:function(e){if(!r.active)return this;var a=S({onDeactivate:c.onDeactivate,onPostDeactivate:c.onPostDeactivate,checkCanReturnFocus:c.checkCanReturnFocus},e);clearTimeout(r.delayInitialFocusTimer),r.delayInitialFocusTimer=void 0,j(),r.active=!1,r.paused=!1,q.deactivateTrap(d,p);var i=g(a,"onDeactivate"),s=g(a,"onPostDeactivate"),f=g(a,"checkCanReturnFocus"),b=g(a,"returnFocus","returnFocusOnDeactivate");i&&i();var v=function(){H(function(){b&&w(A(r.nodeFocusedBeforeActivation)),s&&s()})};return b&&f?(f(A(r.nodeFocusedBeforeActivation)).then(v,v),this):(v(),this)},pause:function(){return r.paused||!r.active?this:(r.paused=!0,j(),this)},unpause:function(){return!r.paused||!r.active?this:(r.paused=!1,F(),I(),this)},updateContainerElements:function(e){var a=[].concat(e).filter(Boolean);return r.containers=a.map(function(i){return typeof i=="string"?n.querySelector(i):i}),r.active&&F(),this}},p.updateContainerElements(t),p};export{ne as createFocusTrap};
