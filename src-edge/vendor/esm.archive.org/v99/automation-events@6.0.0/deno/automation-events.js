/* esm.sh - esbuild bundle(automation-events@6.0.0) deno production */
var g=(e,o,t)=>({endTime:o,insertTime:t,type:"exponentialRampToValue",value:e});var R=(e,o,t)=>({endTime:o,insertTime:t,type:"linearRampToValue",value:e});var A=(e,o)=>({startTime:o,type:"setValue",value:e});var y=(e,o,t)=>({duration:t,startTime:o,type:"setValueCurve",values:e});var _=(e,o,{startTime:t,target:r,timeConstant:i})=>r+(o-r)*Math.exp((t-e)/i);var l=e=>e.type==="exponentialRampToValue";var f=e=>e.type==="linearRampToValue";var s=e=>l(e)||f(e);var v=e=>e.type==="setValue";var u=e=>e.type==="setValueCurve";var x=(e,o,t,r)=>{let i=e[o];return i===void 0?r:s(i)||v(i)?i.value:u(i)?i.values[i.values.length-1]:_(t,x(e,o-1,i.startTime,r),i)};var C=(e,o,t,r,i)=>t===void 0?[r.insertTime,i]:s(t)?[t.endTime,t.value]:v(t)?[t.startTime,t.value]:u(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,x(e,o-1,t.startTime,i)];var E=e=>e.type==="cancelAndHold";var V=e=>e.type==="cancelScheduledValues";var p=e=>E(e)||V(e)?e.cancelTime:l(e)||f(e)?e.endTime:e.startTime;var S=(e,o,t,{endTime:r,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((e-o)/(r-o)):0;var L=(e,o,t,{endTime:r,value:i})=>t+(e-o)/(r-o)*(i-t);var M=(e,o)=>{let t=Math.floor(o),r=Math.ceil(o);return t===r?e[t]:(1-(o-t))*e[t]+(1-(r-o))*e[r]};var w=(e,{duration:o,startTime:t,values:r})=>{let i=(e-t)/o*(r.length-1);return M(r,i)};var T=e=>e.type==="setTarget";var H=class{constructor(o){this._automationEvents=[],this._currenTime=0,this._defaultValue=o}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(o){let t=p(o);if(E(o)||V(o)){let r=this._automationEvents.findIndex(n=>V(o)&&u(n)?n.startTime+n.duration>=t:p(n)>=t),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),E(o)){let n=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&s(i)){if(n!==void 0&&T(n))throw new Error("The internal list is malformed.");let a=n===void 0?i.insertTime:u(n)?n.startTime+n.duration:p(n),m=n===void 0?this._defaultValue:u(n)?n.values[n.values.length-1]:n.value,d=l(i)?S(t,a,m,i):L(t,a,m,i),h=l(i)?g(d,t,this._currenTime):R(d,t,this._currenTime);this._automationEvents.push(h)}if(n!==void 0&&T(n)&&this._automationEvents.push(A(this.getValue(t),t)),n!==void 0&&u(n)&&n.startTime+n.duration>t){let a=t-n.startTime,m=(n.values.length-1)/n.duration,d=Math.max(2,1+Math.ceil(a*m)),h=a/(d-1)*m,I=n.values.slice(0,d);if(h<1)for(let c=1;c<d;c+=1){let O=h*c%1;I[c]=n.values[c-1]*(1-O)+n.values[c]*O}this._automationEvents[this._automationEvents.length-1]=y(I,n.startTime,a)}}}else{let r=this._automationEvents.findIndex(a=>p(a)>t),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&u(i)&&p(i)+i.duration>t)return!1;let n=l(o)?g(o.value,o.endTime,this._currenTime):f(o)?R(o.value,t,this._currenTime):o;if(r===-1)this._automationEvents.push(n);else{if(u(o)&&t+o.duration>p(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,n)}}return!0}flush(o){let t=this._automationEvents.findIndex(r=>p(r)>o);if(t>1){let r=this._automationEvents.slice(t-1),i=r[0];T(i)&&r.unshift(A(x(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(o){if(this._automationEvents.length===0)return this._defaultValue;let t=this._automationEvents.findIndex(a=>p(a)>o),r=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,n=this._automationEvents[i];if(n!==void 0&&T(n)&&(r===void 0||!s(r)||r.insertTime>o))return _(o,x(this._automationEvents,i-1,n.startTime,this._defaultValue),n);if(n!==void 0&&v(n)&&(r===void 0||!s(r)))return n.value;if(n!==void 0&&u(n)&&(r===void 0||!s(r)||n.startTime+n.duration>o))return o<n.startTime+n.duration?w(o,n):n.values[n.values.length-1];if(n!==void 0&&s(n)&&(r===void 0||!s(r)))return n.value;if(r!==void 0&&l(r)){let[a,m]=C(this._automationEvents,i,n,r,this._defaultValue);return S(o,a,m,r)}if(r!==void 0&&f(r)){let[a,m]=C(this._automationEvents,i,n,r,this._defaultValue);return L(o,a,m,r)}return this._defaultValue}};var b=e=>({cancelTime:e,type:"cancelAndHold"});var P=e=>({cancelTime:e,type:"cancelScheduledValues"});var N=(e,o)=>({endTime:o,type:"exponentialRampToValue",value:e});var j=(e,o)=>({endTime:o,type:"linearRampToValue",value:e});var k=(e,o,t)=>({startTime:o,target:e,timeConstant:t,type:"setTarget"});export{H as AutomationEventList,b as createCancelAndHoldAutomationEvent,P as createCancelScheduledValuesAutomationEvent,N as createExponentialRampToValueAutomationEvent,j as createLinearRampToValueAutomationEvent,k as createSetTargetAutomationEvent,A as createSetValueAutomationEvent,y as createSetValueCurveAutomationEvent};
