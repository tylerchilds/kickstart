/* esm.sh - esbuild bundle(diffhtml@1.0.0-beta.29) deno production */
import __Process$ from "https://deno.land/std@0.165.0/node/process.ts";var __global$ = globalThis || (typeof window !== "undefined" ? window : self);var Ot=Object.defineProperty;var Ct=(e,t)=>{for(var o in t)Ot(e,o,{get:t[o],enumerable:!0})};var w={ELEMENT:1,ATTR:2,TEXT:3,COMMENT:8,FRAGMENT:11},T={STR:"",NUM:1,OBJ:{},ARR:[],MAP:new Map,SET:new Set,DOM:{},FUN:()=>{}},C={SET_ATTRIBUTE:0,REMOVE_ATTRIBUTE:1,NODE_VALUE:2,INSERT_BEFORE:3,REPLACE_CHILD:4,REMOVE_CHILD:5},fe=["attached","detached","replaced","attributeChanged","textChanged"],I=new Map([["attached",new Set],["detached",new Set],["replaced",new Set],["attributeChanged",new Set],["textChanged",new Set]]),M=new Map,x=new Map,ne=new Set,X=new Set,U=new Set,q=new Set,Z=new Set,ue=new Set,ro=T.OBJ,no=T.OBJ,so=T.OBJ,io=T.OBJ,co=T.OBJ,ao=T.OBJ,lo=T.OBJ,fo=T.OBJ,uo=T.OBJ,po=T.OBJ,mo=T.OBJ;var ho=T.OBJ,To=T.OBJ,No=T.OBJ;var y=typeof __Process$<"u"?__Process$:{env:{NODE_ENV:"development"},argv:[]};var R=typeof __global$=="object"?__global$:(typeof window=="object"?window:self)||{};var{parseInt:St}=Number,{parse:kt}=JSON,tt={collectMetrics:!0,executeScripts:!0};function et(e,t){let o=String(e);switch(t){case"boolean":return o!=="false";case"string":return o;case"number":return St(o,10);case"object":return kt(o)}}function _(e,t,o=typeof t,r){let{location:n,URLSearchParams:a}=R,i=typeof a<"u"&&typeof n<"u",c=y.env;if(r&&e in r)return r[e];let h=`DIFF_${e.replace(/[^a-zA-Z0-9]/,"")}`;if(i){let f=new a(n.search),d=h.toLowerCase();if(f.has(d))return et(decodeURIComponent(String(f.get(d))),o)}let l=h.toUpperCase();return c&&l in y.env?et(y.env[l.toUpperCase()],o):t}var Mt=_("initialPoolSize",5e3),j=new Set,pe=new Set,xe=new Set,ot=()=>({rawNodeName:T.STR,nodeName:T.STR,nodeValue:T.STR,nodeType:w.ELEMENT,key:T.STR,childNodes:[],attributes:{}}),Vt={free:j,allocated:pe,protected:xe},rt=j.values(),nt={size:Mt,memory:Vt,fill(){for(let e=j.size;e<this.size;e++)j.add(ot());this.size<j.size&&j.forEach(e=>{j.size!==this.size&&j.delete(e)})},get(){let{value:e=ot(),done:t}=rt.next();return t&&(rt=j.values()),j.delete(e),pe.add(e),e},protect(e){pe.delete(e),xe.add(e)},unprotect(e){(xe.has(e)||pe.has(e))&&(xe.delete(e),pe.delete(e),j.add(e))}};nt.fill();var se=nt;function st(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),o.push.apply(o,r)}return o}function Le(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?st(Object(o),!0).forEach(function(r){Pt(e,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):st(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}function Pt(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var{isArray:me}=Array,{memory:it}=se,Oe="#document-fragment",$e="#text";function ct(e,t=[]){for(let o=0;o<e.length;o++){let r=e[o];r&&r.rawNodeName===Oe?ct(r.childNodes,t):r&&t.push(r)}return t}function b(e,t,o,...r){let n=null;if(it.protected.has(e)||it.allocated.has(e))n=e;else if(!e||me(e)){let f=e?e.length:0;o=[];for(let d=0;d<f;d++)e&&!e[d]||e&&o.push(e[d]);n=b(Oe,null,o)}if(n)return n;let a=typeof e=="object",s=e;if(e&&a&&"ownerDocument"in s){let{nodeType:f}=s;if(f===w.TEXT){let m=b($e,s.nodeValue);return x.set(m,s),m}t={},o=[];let d=s.attributes;if(s.nodeType===w.ELEMENT&&d&&d.length)for(let m=0;m<d.length;m++){let{name:E,value:u}=d[m];if(u===T.STR&&E in s){t[E]=e[E];continue}t[E]=u}if(s.nodeType===w.ELEMENT||s.nodeType===w.FRAGMENT){o=[];for(let m=0;m<s.childNodes.length;m++){let E=s.childNodes[m];o.push(b(E))}}return x.forEach((m,E)=>{m===e&&(n=E)}),n=n||b(s.nodeName,t,o),n.attributes=Le(Le({},n.attributes),t),n.childNodes=o,x.set(n,s),n}if(a){let{rawNodeName:f,nodeName:d,nodeValue:m,attributes:E,childNodes:u,children:N}=e,O=b(f||d,E||null,N||u);return m&&(O.nodeValue=m),O}r.length&&(o=[o,...r]),n=se.get();let p=e===$e;typeof e=="string"?(n.rawNodeName=e,n.nodeName=n.rawNodeName.toLowerCase()):(n.rawNodeName=e,n.nodeName=Oe),n.nodeValue=T.STR,n.key=T.STR,n.childNodes.length=0,n.attributes={};let h=me(t)||typeof t!="object"?t:o,l=ct(me(h)?h:[h]);if(p){let f=l.join(T.STR);return n.nodeType=w.TEXT,n.nodeValue=String(f),n}else n.nodeName===Oe?n.nodeType=w.FRAGMENT:e==="#comment"?n.nodeType=w.COMMENT:n.nodeType=w.ELEMENT;if(h&&l.length&&(!t||!t.childNodes))for(let f=0;f<l.length;f++){let d=l[f];if(me(d))n.childNodes.push(...d);else if(d)d.nodeType===w.FRAGMENT&&typeof d.rawNodeName=="string"?n.childNodes.push(...d.childNodes):d&&typeof d=="object"?n.childNodes.push(b(d)):n.childNodes.push(b($e,null,d));else continue}if(t&&typeof t=="object"&&!me(t)&&(n.attributes=Le({},t),t.childNodes)){let f=typeof t.childNodes=="object";n.childNodes.push(f?b(t.childNodes):b("#text",t.childNodes))}return n.nodeName==="script"&&n.attributes.src&&(n.key=String(n.attributes.src)),n.attributes&&"key"in n.attributes&&(n.key=String(n.attributes.key)),X.size&&X.forEach((f,d)=>{(d=f(n))&&(n=b(d))}),n}var Te="__DIFFHTML__",Be=/<!DOCTYPE.*>/i,je=/[^ ]/,B=new RegExp(`${Te}([^_]*)__`),Rt={tags:[],attributes:{},children:{}},{assign:at}=Object,{isArray:lt}=Array,vt=["script","noscript","style","template"],At=["source","embed","param","track","input","meta","link","area","base","col","wbr","img","br","hr"],dt={li:{li:!0},p:{p:!0,div:!0},td:{td:!0,th:!0},th:{td:!0,th:!0}},_t={li:{ul:!0,ol:!0},a:{div:!0},b:{div:!0},i:{div:!0},p:{div:!0},td:{tr:!0,table:!0},th:{tr:!0,table:!0}},he=(e,t,o)=>{if("childNodes"in e.attributes)return;if(t&&!Be.test(t)&&!B.test(t))return e.childNodes.push(b("#text",t));let r=[],n=t.split(B);for(let a=0;a<n.length;a++){let s=n[a];if(s)if(a%2===1){let p=o.children[s],i=s in o.children?p:b("#text",`${Te}${s}__`);if(!i)continue;let c=i.nodeType===w.FRAGMENT;typeof i.rawNodeName=="string"&&c?r.push(...i.childNodes):r.push(i)}else Be.test(s)||r.push(b("#text",s))}e.childNodes.push(...r)},ft=(e,t,o,r)=>{let n=null,a=/([_@$#a-z][^\s\x00-\x1F"'>\/=\uFDD0-\uFDEF\uFFFE\uFFFF]*)\s*(=\s*("([^"]+)"|'([^']+)'|(\S+)))?/ig;if(n=B.exec(e))return ft(o.tags[n[1]],t,o,r);let s={};for(let p;p=a.exec(t||T.STR);){let i=typeof e=="string",c=p[1],h;if(c===""){let E=t.match(B);h=E?E[0]:""}let l=p[6]||p[5]||p[4],f=h||l||(i?p[1]:l||!0),d=f==="''"||f==='""'?T.STR:f,m=String(d).match(B);if(m&&m.length){let E=String(d).split(B),u=B.exec(c),N=u?o.attributes[u[1]]:c;for(let g=0;g<E.length;g++){let O=E[g];if(O)if(g%2===1){let v=typeof N=="object",A=O in o.attributes,P=o.attributes[O],k=`${Te}${O}__`;if(s[N])s[N]+=A?P:k;else if(v){if(N&&!lt(N))at(s,N);else if(y.env.NODE_ENV!=="production")throw new Error("Arrays cannot be spread as attributes")}else if(N){let ae=A?P:k;s[N]=l?ae:!0}}else s[N]?s[N]+=O:s[N]=O}}else if(m=B.exec(c)){let E=o.attributes[m[1]];typeof E=="object"&&!lt(E)?at(s,E):s[E]=d}else s[c]=l!==void 0?d:!0}return b(e,s,s.childNodes||[])};function Q(e,t,o={}){o.parser||(o.parser={}),t||(t=Rt);let r=new Set(_("rawElements",vt,"array",o.parser)),n=new Set(_("selfClosingElements",At,"array",o.parser)),a=/<!--[^]*?(?=-->)-->|<(\/?)([a-z\-\_][a-z0-9\-\_]*)\s*([^>]*?)(".*?"|'.*?')?(\/?)>/ig,s=b("#document-fragment",null,[]),p=[s],i=s,c=-1;if(y.env.NODE_ENV!=="production"){let l=[e];if(!e.includes("<")&&o.parser.strict)throw l.splice(1,0,`
Possibly invalid markup. Opening tag was not properly opened.
      `),new Error(`

${l.join(`
`)}`);if(!e.includes(">")&&o.parser.strict)throw l.splice(1,0,`
Possibly invalid markup. Opening tag was not properly closed.
      `),new Error(`

${l.join(`
`)}`)}if(!e.includes("<")&&e)return he(i,e,t),s;for(let l,f,d=0;l=a.exec(e);d++){let[m,E,u,N,g,O]=l;c>-1&&c+m.length<a.lastIndex&&(f=e.slice(c,a.lastIndex-m.length),f&&he(i,f,t));let v=a.lastIndex-m.length;if(c===-1&&v>0){let S=e.slice(0,v);S&&!Be.exec(S)&&he(i,S,t)}if(c=a.lastIndex,l[0][1]==="!")continue;let A=B.exec(u),P=A&&t.tags[A[1]],k=P?P.name||P:u,ae;if(!E){!l[4]&&dt[i.rawNodeName]&&dt[i.rawNodeName][k]&&(p.pop(),i=p[p.length-1]);let S=N+(g||"");if(i=i.childNodes[i.childNodes.push(ft(u,S,t,o))-1],p.push(i),o.parser.strict||r.has(k)){let te=`</${k}>`,oe=e.indexOf(te,a.lastIndex);if(y.env.NODE_ENV!=="production"&&oe===-1&&o.parser.strict&&!n.has(k)){let re=e.slice(a.lastIndex-m.length).split(`
`).map(le=>le.replace(B,(Ie,de)=>{if(!t)return Ie;let{tags:He,children:wt,attributes:xt}=t;return He[de]||wt[de]||xt[de]})).slice(0,3),we=je.exec(re[0]),De=Array((we?we.index-1:0)+te.length-1).join(" ")+"^";throw re.splice(1,0,`${De}
    Possibly invalid markup. <${k}> must be closed in strict mode.
            `),new Error(`

${re.join(`
`)}`)}if(r.has(k)){oe===-1?c=a.lastIndex=e.length+1:(c=oe+te.length,a.lastIndex=c,ae=!0);let re=e.slice(l.index+m.length,oe);he(i,re,t)}}}if(ae||E||O||n.has(k)){if(y.env.NODE_ENV!=="production"&&i&&k!==i.rawNodeName&&o.parser.strict){let S=i.rawNodeName,te=e.slice(a.lastIndex-m.length).split(`
`).map(we=>we.replace(B,(De,le)=>{if(!t)return De;let{tags:Ie,children:de,attributes:He}=t;return Ie[le]||de[le]||He[le]})).slice(0,3),oe=je.exec(te[0]),re=Array(oe?oe.index:0).join(" ")+"^";throw te.splice(1,0,`${re}
  Possibly invalid markup. Saw ${k}, expected ${S}...
          `),new Error(`

${te.join(`
`)}`)}for(;i;){if(O==="/"&&A){p.pop(),i=p[p.length-1];break}else if(P&&i.rawNodeName===k){p.pop(),i=p[p.length-1];break}if(i.rawNodeName===k){p.pop(),i=p[p.length-1];break}else{let S=_t[i.rawNodeName];if(S&&S[k]){p.pop(),i=p[p.length-1];continue}break}}}}let h=e.slice(c===-1?0:c);if(y.env.NODE_ENV!=="production"&&(h.includes(">")||h.includes("<"))&&o.parser.strict){let l=[h],f=je.exec(l[0]),d=Array(f?f.index:0).join(" ")+"^";throw h.includes(">")?l.splice(1,0,`${d}
  Possibly invalid markup. Opening tag was not properly opened.
        `):l.splice(1,0,`${d}
  Possibly invalid markup. Opening tag was not properly closed.
        `),new Error(`

${l.join(`
`)}`)}if(h&&he(i,h,t),s.childNodes.length&&s.childNodes[0].nodeName==="html"){let l={before:[],after:[]},f={after:[]},d=s.childNodes[0],m=!0,E=!0;if(d.childNodes=d.childNodes.filter(u=>{if(u.nodeName==="body"||u.nodeName==="head")return u.nodeName==="head"&&(m=!1),u.nodeName==="body"&&(E=!1),!0;u.nodeType===w.ELEMENT&&(m&&E?l.before.push(u):!m&&E?l.after.push(u):E||f.after.push(u))}),!d.childNodes[0]||d.childNodes[0].nodeName!=="head"){let u=b("head",null,[]);if(u){let N=u.childNodes;N.unshift.apply(N,l.before),N.push.apply(N,l.after),d.childNodes.unshift(u)}}else{let u=d.childNodes[0].childNodes;u.unshift.apply(u,l.before),u.push.apply(u,l.after)}if(!d.childNodes[1]||d.childNodes[1].nodeName!=="body"){let u=b("body",null,[]);if(u){let N=u.childNodes;N.push.apply(N,f.after),d.childNodes.push(u)}}else{let u=d.childNodes[1].childNodes;u.push.apply(u,f.after)}}return s}var Dt="diffHTML",Ce=new Map,It=0;function Ne(e){let{mount:t,input:o}=e,r=o,n=It++;return _("collectMetrics",!1)?a=>{a=`[${n}] ${a}`;let{host:s}=t;t&&s?a=`${s.constructor.name} ${a}`:r&&typeof r.rawNodeName=="function"&&(a=`${r.rawNodeName.name} ${a}`);let p=`${a}-end`;if(Ce.has(a)){let i=Ce.get(a)||0,c=(performance.now()-i).toFixed(3);Ce.delete(a),performance.mark(p),performance.measure(`${Dt} ${a} (${c}ms)`,a,p)}else Ce.set(a,performance.now()),performance.mark(a)}:T.FUN}var Je={};Ct(Je,{gc:()=>Ye,protectVTree:()=>F,unprotectVTree:()=>Y});var{protect:Ht,unprotect:Lt,memory:Fe}=se;function F(e){if(Ht(e),e.childNodes.length)for(let t=0;t<e.childNodes.length;t++)F(e.childNodes[t])}function Y(e){if(e.childNodes.length)for(let t=0;t<e.childNodes.length;t++)Y(e.childNodes[t]);x.delete(e),Lt(e)}function Ye(){Fe.allocated.forEach(e=>{e.attributes={},e.childNodes.length=0,Fe.free.add(e),Fe.allocated.delete(e),x.delete(e)})}function Se(e){let{state:t,state:{isRendering:o}}=e;t.measure("schedule"),M.forEach(a=>{let s=a.activeTransaction&&a.activeTransaction.mount,p=e.mount;!s||!p||!a.isRendering||(s.contains&&s.contains(p)||p.contains&&p.contains(s)||s===p)&&(t=a,o=!0)});let{activeTransaction:r,nextTransaction:n}=t;if(o){let{tasks:a}=e;t.nextTransaction=e,e.abort();let s=n&&n.promise||r.promise||Promise.resolve();return e.promise=s.then(()=>(e.aborted=!1,e.state.isRendering=!0,e.state.activeTransaction=e,t.measure("schedule"),V.flow(e,a.slice(1))))}t.isRendering=!0,t.activeTransaction=e,t.measure("schedule")}function ke(e){let{mount:t,input:o,state:{measure:r},config:n}=e,a=n.inner?"innerHTML":"outerHTML";if(r("should update"),typeof o=="string"&&t[a]===o)return e.abort(!0);r("should update")}var pt=typeof requestIdleCallback<"u",ut=-1,$t=e=>(pt?requestIdleCallback:setTimeout)(e),jt=e=>(pt?cancelIdleCallback:clearTimeout)(e);function H(e){if(M.has(e)){let{mutationObserver:o,oldTree:r}=M.get(e);o&&o.disconnect(),r&&!x.has(r)&&(Z.forEach(n=>n(r)),Y(r)),M.delete(e)}if(!e)return;let t=e;if(t.childNodes&&t.childNodes.length)for(let o=0;o<t.childNodes.length;o++)H(t.childNodes[o]);t.shadowRoot&&H(t.shadowRoot),x.forEach((o,r)=>{o===t&&(Z.forEach(n=>n(r)),Y(r))}),jt(ut),ut=$t(Ye)}function ce(e){let{state:t,mount:o,input:r,config:n}=e,{inner:a}=n,s=o;t.mutationObserver&&!t.isDirty?t.isDirty=Boolean(t.mutationObserver.takeRecords().length):t.mutationObserver||(t.isDirty=!1),(t.isDirty||!t.oldTree)&&(H(s),s.ownerDocument&&t.mutationObserver&&t.mutationObserver.observe(s,{subtree:!0,childList:!0,attributes:!0,characterData:!0}),t.oldTree=b(s),F(t.oldTree),M.set(o,t));let{nodeName:p,attributes:i}=t.oldTree;e.newTree||(e.newTree=b(r));let c=e.newTree;if(!a&&c.nodeType===w.FRAGMENT&&t.oldTree.nodeType!==w.FRAGMENT){let f=[];for(let d=0;d<c.childNodes.length;d++){let m=c.childNodes[d];(!(m.nodeType===w.TEXT)||m.nodeValue.trim())&&f.push(m)}f.length===1?e.newTree=f[0]:f.length>1&&(e.newTree=b(c.childNodes))}e.oldTree=t.oldTree;let{oldTree:h,newTree:l}=e;if(a&&h&&l){let f=typeof l.rawNodeName!="string",m=l.nodeType===w.FRAGMENT&&!f?l.childNodes:l;e.newTree=b(p,i,m)}}var{max:Bt}=Math,mt=["old","new"],ht="#text";function J(e,t,o=[],r={},n=T.OBJ,a){e||(e=T.OBJ),t||(t=T.OBJ);let{svgElements:s=new Set}=r,p=e.nodeName,i=t.nodeName,c=e===T.OBJ||a,h=i==="svg"||s.has(t),l=null;if(q.size&&q.forEach(u=>{let N=u(e,t,n);N&&N===e?l=o:N===!1?l=!1:N&&(t=N)}),l!==null||!t)return l;if(i===ht){if(p===ht&&e.nodeValue!==t.nodeValue)return o.push(C.NODE_VALUE,e,t.nodeValue,e.nodeValue),e.nodeValue=t.nodeValue,o;if(c)return o.push(C.NODE_VALUE,t,t.nodeValue,null),o}let f=t.childNodes||[];if(t.nodeType===w.ELEMENT){let u=c?T.OBJ:e.attributes,N=t.attributes||{};for(let g in N){let O=N[g];g in u&&u[g]===N[g]||(c||(u[g]=O),!((!e||e.nodeName!=="script")&&t.nodeName==="script"&&g==="type")&&o.push(C.SET_ATTRIBUTE,c?t:e,g,O))}if(!c)for(let g in u)g in N||(o.push(C.REMOVE_ATTRIBUTE,e,g),delete u[g])}if(a){for(let u=0;u<f.length;u++)h&&s.add(f[u]),J(null,f[u],o,r,n,!0);return o}let d={old:new Map,new:new Map};for(let u=0;u<mt.length;u++){let N=mt[u],g=d[N],O=arguments[u],v=O&&O.childNodes;if(v&&v.length)for(let A=0;A<v.length;A++){let P=v[A];if(P.key){if(y.env.NODE_ENV!=="production"&&g.has(P.key))throw new Error(`Key: ${P.key} cannot be duplicated`);g.set(P.key,P)}}}let m=e.childNodes||[],E=Bt(f.length,m.length);for(let u=0;u<E;u++){let N=m&&m[u],g=f[u];if((h||g&&g.nodeName==="svg")&&s.add(g),!g){J(N,null,o,r,n,!0)===!1&&f.splice(u,0,N);continue}if(!N){m.push(g),J(null,g,o,r,n,!0),o.push(C.INSERT_BEFORE,e,g,null);continue}let O=g.key,v=N.key,A=d.new.has(v),P=d.old.has(O);if(v||O){if(!A&&!P){m.splice(m.indexOf(N),1,g),J(null,g,o,r,n,!0),o.push(C.REPLACE_CHILD,g,N),u=u-1;continue}else if(!A){o.push(C.REMOVE_CHILD,N),m.splice(m.indexOf(N),1),u=u-1;continue}if(O!==v){let S=g;O&&P?(S=d.old.get(O),m.splice(m.indexOf(S),1)):S=g,J(null,S,o,r,n,!0),o.push(C.INSERT_BEFORE,e,S,N),m.splice(u,0,S);continue}}let k=N.nodeName===g.nodeName;if(J(N,g,o,r,n,!k)===!1){f.splice(u,0,N),E+=1;continue}if(!k){m[u]=g;let S=m.lastIndexOf(g);S>u&&m.splice(S,1),o.push(C.REPLACE_CHILD,g,N)}}if(m.length!==f.length){for(let u=f.length;u<m.length;u++)o.push(C.REMOVE_CHILD,m[u]);m.length=f.length}return o}var Ft="http://www.w3.org/2000/svg";function L(e,t=R.document,o){if(y.env.NODE_ENV!=="production"&&!e)throw new Error("Missing VTree when trying to create DOM Node");let r=b(e),n=x.get(r);if(n)return n;let{nodeName:a,rawNodeName:s=a,childNodes:p=[]}=r;o=o||a==="svg";let i=null,c=null;if(U.forEach(l=>{(c=l(r))&&(i=c)}),!t)return i;let h=i;h||(a==="#text"?h=t.createTextNode(r.nodeValue||T.STR):a==="#document-fragment"?h=t.createDocumentFragment():o?h=t.createElementNS(Ft,s):h=t.createElement(s),a==="script"&&(h.type="no-execute")),x.set(r,h);for(let l=0;l<p.length;l++){let f=L(p[l],t,o);h&&f&&h.appendChild(f)}return h}function Me(e){let{state:t,state:{measure:o},oldTree:r,newTree:n,mount:a}=e;if(o("sync trees"),y.env.NODE_ENV!=="production"){if(!r)throw new Error("Missing old tree during synchronization");if(!n)throw new Error("Missing new tree during synchronization")}if(r&&n&&r.nodeName!==n.nodeName&&n.nodeType!==w.FRAGMENT){if(y.env.NODE_ENV!=="production"&&!a.parentNode)throw new Error("Unable to replace top level node without a parent");e.patches=[C.REPLACE_CHILD,n,r],e.oldTree=t.oldTree=n;let s=L(n);M.delete(a),M.set(s,t),e.mount=s,n.nodeName==="script"&&t.scriptsToExecute.set(n,n.attributes.type||T.STR)}else e.patches=J(r||null,n||null,[],t,e);o("sync trees")}function Tt(e,t){if(y.env.NODE_ENV!=="production"){if(!fe.includes(e))throw new Error(`Invalid state name '${e}'`);if(!t)throw new Error("Missing transition state callback")}I.get(e)?.add(t)}function Nt(e,t){if(y.env.NODE_ENV!=="production"&&e&&!fe.includes(e))throw new Error(`Invalid state name '${e}'`);if(!t&&e)I.get(e)?.clear();else if(e&&t)I.get(e)?.delete(t);else for(let o=0;o<fe.length;o++)I.get(fe[o])?.clear()}function G(e,...t){let o=I.get(e),r=[];if(!o)return r;let n=t[0],a=n.nodeType===w.ELEMENT;return!o.size||e!=="textChanged"&&!a||(o.forEach(s=>{let p=t.map(c=>x.get(c)||c),i=s(...p);typeof i=="object"&&i.then&&r.push(i)}),(e==="attached"||e==="detached")&&n.childNodes.forEach(s=>{r.push(...G(e,s,...t.slice(1)))})),r}var ze=R.document?document.createElement("div"):null;function W(e){return!ze||!e||!e.indexOf||!e.includes("&")?e:(ze.innerHTML=e,ze.textContent||T.STR)}var ie=Symbol.for("diff.strict"),Ue=Symbol.for("diff.after"),Ve=Symbol.for("diffHTML");var{keys:Yt}=Object,Pe=new Set,Re=new Set,Jt=(e,t,o,r)=>{let n=typeof r=="object"&&r,a=typeof r=="function",s=typeof r=="symbol",p=o.indexOf("on")===0,i=t,c=p?o.toLowerCase():o,h="s-"+e.nodeName+"-"+c,l=t;if(Re.has(h))i[c]=r;else if(!Pe.has(h))try{i[c]=r,Re.add(h)}catch{Pe.add(h)}if(!n&&!a&&!s){let f=r==null||r===!0;l.setAttribute(c,f?T.STR:r)}else if(n&&c==="style"){let f=Yt(r);for(let d=0;d<f.length;d++)l.style[f[d]]=r[f[d]]}},zt=(e,t,o)=>{let r="r-"+e.nodeName+"-"+o,n=t;if(Re.has(r))n[o]=void 0,delete n[o];else if(!Pe.has(r))try{n[o]=void 0,delete n[o],Re.add(r)}catch{Pe.add(r)}t.removeAttribute(o)},Et=(e,t)=>{let o=e;t.includes("&")?o.nodeValue=W(t):o.nodeValue=t};function Ge(e,t=T.OBJ){let o=[],{ownerDocument:r,svgElements:n=new Set}=t,{length:a}=e,s=0;for(;;){let p=e[s];if(s===a)break;switch(p){case C.REMOVE_ATTRIBUTE:case C.SET_ATTRIBUTE:{let i=p===C.SET_ATTRIBUTE,c=e[s+1],h=e[s+2],l=i?W(e[s+3]):null;s+=i?4:3;let f=n.has(c),d=L(c,r,f),m=d.getAttribute(h),E=G("attributeChanged",c,h,m,l);F(c);let u=i?Jt:zt;E.length?(Promise.all(E).then(()=>u(c,d,h,l)),o.push(...E)):u(c,d,h,l);break}case C.NODE_VALUE:{let i=e[s+1],c=e[s+2],h=e[s+3],l=n.has(i);s+=4;let f=L(i,r,l);F(i);let d=G("textChanged",i,h,c);d.length?(Promise.all(d).then(()=>Et(f,c)),o.push(...d)):Et(f,c);break}case C.INSERT_BEFORE:{let i=e[s+1],c=e[s+2],h=e[s+3];if(s+=4,!x.has(i)&&i!==Ue)continue;let l=x.get(i);if(i===Ue){let E=x.get(h);E&&(l=E.parentNode,h=E.nextSibling?E.nextSibling:null)}let f=n.has(c);F(c);let d=h&&L(h,r,f),m=L(c,r,f);l.insertBefore(m,d||null),o.push(...G("attached",c));break}case C.REPLACE_CHILD:{let i=e[s+1],c=e[s+2];s+=3;let h=n.has(i),l=x.get(c),f=L(i,r,h);if(!l||!l.parentNode)break;F(i);let d=I.get("attached")?.size,m=I.get("detached")?.size,E=I.get("replaced")?.size;if(!d&&!m&&!E){l.parentNode.replaceChild(f,l),Y(c);break}l.parentNode.insertBefore(f,l);let u=[...d&&G("attached",i)||T.ARR,...m&&G("detached",c)||T.ARR,...E&&G("replaced",c,i)||T.ARR];u.length?(Promise.all(u).then(()=>{l.parentNode&&l.parentNode.removeChild(l),Y(c)}),o.push(...u)):(l.parentNode.removeChild(l),Y(c));break}case C.REMOVE_CHILD:{let i=e[s+1];s+=2;let c=x.get(i);if(!c||!c.parentNode)break;let h=G("detached",i);h.length?(Promise.all(h).then(()=>{c.parentNode&&c.parentNode.removeChild(c),Y(i)}),o.push(...h)):(c.parentNode.removeChild(c),Y(i));break}}}return o}function ve(e){let{mount:t,state:o,patches:r}=e,{mutationObserver:n,measure:a,scriptsToExecute:s}=o;a("patch node");let{ownerDocument:p}=t,i=e.promises||[];o.ownerDocument=p||R.document,n&&n.disconnect();let c=h=>{h.nodeName==="script"&&s.set(h,h.attributes.type)};U.add(c),o.ownerDocument&&i.push(...Ge(r,o)),U.delete(c),e.promises=i,a("patch node")}function Ae(e){let{promises:t}=e;return t&&t.length?e.promise=Promise.all(t).then(()=>e.end()):e.promise=Promise.resolve(e.end())}var gt=R.document?document.createElement("script"):null;function Ke(){return Boolean(gt&&"noModule"in gt)}function K(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var{assign:Ut}=Object,$=[Se,ke,ce,Me,ve,Ae],Ee={schedule:Se,shouldUpdate:ke,reconcileTrees:ce,syncTrees:Me,patchNode:ve,endAsPromise:Ae},V=class{static create(t,o,r){return new V(t,o,r)}static flow(t,o){let r=t;for(let n=0;n<o.length;n++)if(t.aborted||(r=o[n](t),r!==void 0&&r!==t))return r;return r}static assert(t){if(y.env.NODE_ENV!=="production"){if(typeof t.mount!="object"||!t.mount)throw new Error("Transaction requires a DOM Node mount point");if(t.aborted&&t.completed)throw new Error("Transaction was previously aborted");if(t.completed)throw new Error("Transaction was previously completed")}}static invokeMiddleware(t){let{state:{measure:o},tasks:r}=t;ne.forEach(n=>{let a=`invoke ${n.name||"anon"}`;o(a);let s=n(t);s&&r.push(s),o(a)})}constructor(t,o,r){K(this,"state",T.OBJ),K(this,"mount",T.OBJ),K(this,"input",T.OBJ),K(this,"oldTree",void 0),K(this,"newTree",void 0),K(this,"promise",void 0),K(this,"promises",void 0),K(this,"tasks",[]),K(this,"patches",[]),this.mount=t,this.input=o,this.config=r;let n=!r.disableMutationObserver&&"MutationObserver"in(R.window||T.OBJ);this.state=M.get(t)||{measure:Ne(this),svgElements:new Set,scriptsToExecute:new Map,activeTransaction:this,mutationObserver:n&&new R.window.MutationObserver(T.FUN)},this.tasks=_("tasks",$,void 0,r).slice(),this.endedCallbacks=new Set,M.set(t,this.state)}start(){y.env.NODE_ENV!=="production"&&V.assert(this);let{state:{measure:t},tasks:o}=this,r=o.pop();return t("render"),this.aborted=!1,V.invokeMiddleware(this),r&&o.push(r),V.flow(this,o)}abort(t){if(this.aborted=!0,t)return this.tasks[this.tasks.length-1](this)}end(){let{state:t,config:o,mount:r}=this,{mutationObserver:n,measure:a,svgElements:s,scriptsToExecute:p}=t,i=r;return a("finalize"),this.completed=!0,s.clear(),t.isRendering=!1,t.isDirty=!1,i.ownerDocument&&n?n.observe(i,{subtree:!0,childList:!0,attributes:!0,characterData:!0}):t.isDirty=!0,p.forEach((c,h)=>{let l=x.get(h);if(l.type=c,!o.executeScripts||Ke()&&c==="nomodule")return;let f=Ut(l.ownerDocument.createElement("script"),l);for(let d in h.attributes){let m=h.attributes[d];f.setAttribute(d,m)}f.textContent=l.textContent,M.has(l)&&(H(l),M.set(f,t)),x.set(h,f),l.parentNode&&l.parentNode.replaceChild(f,l)}),p.clear(),this.endedCallbacks.forEach(c=>c(this)),this.endedCallbacks.clear(),a("finalize"),a("render"),t.oldTree&&F(t.oldTree),this}onceEnded(t){this.endedCallbacks.add(t)}};function Xe(e){let{state:t,input:o,config:r}=e,{measure:n}=t;if(typeof o=="string"){n("parsing input for new tree");let{childNodes:a}=Q(o,void 0,r),s=b(a);s&&(e.newTree=s),n("parsing input for new tree")}}function ge(e){return e.replace(/[&<>]/g,t=>`&#${t.charCodeAt(0)};`)}function bt(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),o.push.apply(o,r)}return o}function Gt(e){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?bt(Object(o),!0).forEach(function(r){Kt(e,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):bt(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}function Kt(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var Xt={StateCache:M,NodeCache:x,TransitionCache:I,MiddlewareCache:ne,CreateTreeHookCache:X,CreateNodeHookCache:U,SyncTreeHookCache:q,ReleaseHookCache:Z,ParseHookCache:ue},ee=Gt({decodeEntities:W,escape:ge,makeMeasure:Ne,memory:Je,Pool:se,process:y,PATCH_TYPE:C,globalConfig:tt,createNode:L,syncTree:J,Transaction:V,defaultTasks:$,tasks:Ee},Xt);function qe(e,t=T.STR,o={}){return o.inner=!0,o.executeScripts="executeScripts"in o?o.executeScripts:!0,o.tasks=o.tasks||$,V.create(e,t,o).start()}function Ze(e,t=T.STR,o={}){return o.inner=!1,o.executeScripts="executeScripts"in o?o.executeScripts:!0,o.tasks=o.tasks||$,V.create(e,t,o).start()}var{keys:qt}=Object;function We(e,t={}){let o=b(),r=new Set(t.tasks||$);r.delete(Ee.patchNode),r.delete(Ee.endAsPromise),r.add(function(s){return Qe(s.oldTree)}),t.tasks=[...r],t.inner=!0;let n="";try{n=V.create(o,e,t).start()}catch(a){throw H(o),a}return H(o),n}function yt(e){let t=qt(e);return t.length?" "+t.map(o=>{let r=e[o],n=!r,a=typeof r=="object"||typeof r=="function";return r===!0?o:`${o}${!n&&!a?`="${String(r)}"`:""}`}).join(" "):""}function Qe(e){let t="";if(!e)return t;let{childNodes:o,nodeType:r,nodeName:n,nodeValue:a,attributes:s}=e;if(r===11)for(let p=0;p<o.length;p++)t+=Qe(o[p]);else if(!o.length&&r===1)t+=`<${n}${yt(s)}></${n}>`;else if(r===3)t+=a;else if(o.length){let p=o.map(i=>`${Qe(i)}`).join("");t+=`<${n}${yt(s)}>${p}</${n}>`}return t}var{isArray:Zt}=Array,Qt=/(<|\/)/,Wt=e=>{let t=e.shift();return typeof t=="string"?ge(W(t)):t};function z(e,...t){let o=b("#text",T.STR);if(e)typeof e=="string"&&(e=[e]);else return o;if(e.length===1&&!t.length){if(!e[0])return o;let p=_("strict",!1,"boolean",{strict:z[ie]});delete z[ie];let{childNodes:i}=Q(e[0],void 0,{parser:{strict:p}});return b(i.length===1?i[0]:i)}let r=T.STR,n={attributes:{},children:{},tags:{}};e.forEach((p,i)=>{if(r+=p,t.length){let c=Wt(t),h=r.trim().slice(-1),l=r.lastIndexOf(">")<r.lastIndexOf("<"),f=Boolean(h.match(Qt)),d=typeof c=="object",m=`${Te}${i}__`;f?(n.tags[i]=c,r+=m):l?(n.attributes[i]=c,r+=m):Zt(c)||d?(n.children[i]=b(c),r+=m):c&&(r+=c)}});let a=_("strict",!1,"boolean",{strict:z[ie]}),{childNodes:s}=Q(r,n,{parser:{strict:a}});return b(s.length===1?s[0]:s)}delete z[ie];function eo(e,...t){z[ie]=!0;try{return z(e,...t)}catch(o){throw z[ie]=!1,o}}z.strict=eo;var{isArray:to}=Array;function _e(e){let t=typeof e=="function",o=typeof e=="object";if(y.env.NODE_ENV!=="production"&&(!e||!t&&!o||to(e)))throw new Error("Middleware must be a function or plain object");let{subscribe:r,unsubscribe:n,createTreeHook:a,createNodeHook:s,syncTreeHook:p,releaseHook:i,parseHook:c}=e;return t&&ne.add(e),r&&r(ee),a&&X.add(a),s&&U.add(s),p&&q.add(p),i&&Z.add(i),c&&ue.add(c),()=>{t&&ne.delete(e),n&&n(ee),a&&X.delete(a),s&&U.delete(s),p&&q.delete(p),i&&Z.delete(i),c&&ue.delete(c)}}var be="1.0.0-beta.29";$.splice($.indexOf(ce),0,Xe);ee.parse=Q;ee.VERSION=be;var D={};D.VERSION=be;D.addTransitionState=Tt;D.removeTransitionState=Nt;D.release=H;D.createTree=b;D.use=_e;D.outerHTML=Ze;D.innerHTML=qe;D.toString=We;D.html=z;D.Internals=ee;var ye=R;if(Ve in R){let e=ye[Ve];be!==e.VERSION&&console.log(`Loaded ${be} after ${e.VERSION}`)}ye[Ve]=D;ye.devTools&&(ye.unsubscribeDevTools=_e(ye.devTools(ee)));var oi=D;export{ee as Internals,be as VERSION,Tt as addTransitionState,b as createTree,oi as default,z as html,qe as innerHTML,Ze as outerHTML,H as release,Nt as removeTransitionState,We as toString,_e as use};
